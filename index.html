<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="description"
      content="Interactive visualizations of chess statistics in Canada"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Canadian Chess Statistics</title>
    <!-- D3.js -->
    <!-- <script src="https://d3js.org/d3.v7.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
    <script>
      window.d3v7 = window.d3; // Store D3 v7
      delete window.d3; // Remove it from global scope
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.12/d3.min.js"></script>
    <script>
      window.d3v3 = window.d3; // Store D3 v3
      window.d3 = window.d3v7; // Restore D3 v7 as the default

      console.log("D3 v7:", d3v7.version); // Should log 7.9.0
      console.log("D3 v3:", d3v3.version); // Should log 3.5.12
    </script>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Satisfy"
      rel="stylesheet"
      type="text/css"
    />

    <link rel="stylesheet" type="text/css" href="css/ChessDataViz.css" />
    <script src="js/ChessDataViz.min.js"></script>

    <link
      rel="stylesheet"
      href="https://unpkg.com/fullpage.js/dist/fullpage.min.css"
    />
    <script src="https://unpkg.com/fullpage.js/dist/fullpage.min.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="css/style.css" />
  </head>
  <body class="chess-animated-bg">
    <div id="fullpage">
      <!--Title Page Section-->
      <div class="section" id="title-page">
        <!-- <img src="img/pirouetti/bQ.svg" class="chess-piece-icon piece-king top-right" alt="King chess piece"> -->

        <div class="container h-100">
          <div class="row h-100">
            <div class="col-12 h-100">
              <div id="title-container"></div>
            </div>
          </div>
          <div class="col-sm-2"></div>
        </div>
      </div>

      <!-- Title Section - Outside fullpage -->
      <div class="section" id="title-section">
        <div class="title-content">
          <h1 class="title-text">How many chess players are in Canada?</h1>
          <p class="subtitle-text">
            Chess has been gaining popularity worldwide, but few people know the
            exact scale of organized chess in Canada. Take a guess below.
          </p>
          <div class="guess-container">
            <div class="guess-label">Your estimate:</div>
            <div class="guess-input-container">
              <input
                type="number"
                class="guess-input"
                id="player-guess"
                placeholder="Enter a number..."
                min="0"
              />
            </div>
            <button class="guess-button" id="submit-guess">Submit Guess</button>
            <div class="feedback" id="guess-feedback"></div>
          </div>
        </div>
        <div class="history-content" id="chess-history-container">
          <h2 class="history-title">Chess in Canadian History</h2>
          <p class="history-text">
            Chess has played a significant role in Canadian cultural history
            since the late 19th century. The Chess Federation of Canada, founded
            in 1932, has been instrumental in organizing national tournaments
            and promoting the game across the country's diverse communities.
          </p>
          <p class="history-text">
            Notable Canadian chess players have included Grandmaster Duncan
            Suttles, International Master Lawrence Day, and more recently,
            Grandmaster Anton Kovalyov. The Canadian Open Chess Championship,
            established in 1956, remains one of North America's premier chess
            events, drawing competitors from around the world.
          </p>
          <p class="history-text">
            Today, chess continues to grow in popularity across Canada, with
            programs in schools, community centers, and online platforms
            fostering new generations of players from diverse backgrounds.
          </p>
        </div>
      </div>

      <!-- Grid Section - Outside fullpage -->
      <div class="section" id="grid-section">
        <div class="grid-container" id="grid-display-container">
          <!-- Grid goes here, will be created by JavaScript -->
          <svg id="grid-svg" width="100%" height="100%"></svg>
        </div>
        <div class="info-container" id="grid-info-container">
          <h2 class="info-title">Chess Player Rating Distribution</h2>
          <p class="info-stat">
            There are approximately 10,000 chess players in the Canadian Chess
            Federation database. Their rating distribution reveals the pyramid
            structure of competitive chess.
          </p>
          <h3 class="legend-title">Rating Ranges</h3>
          <div class="legend">
            <div class="legend-item">
              <div class="legend-color" style="background-color: #0072b2"></div>
              <div>1-1199 (50.9%)</div>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background-color: #56b4e9"></div>
              <div>1200-1699 (33.1%)</div>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background-color: #f0e442"></div>
              <div>1700-1899 (9.4%)</div>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background-color: #e69f00"></div>
              <div>1900-2299 (5.6%)</div>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background-color: #d55e00"></div>
              <div>2300+ (1.0%)</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Hourglass Section - Outside fullpage -->
      <div class="section" id="hourglass-section">
        <div
          class="hourglass-container"
          style="
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
          "
        >
          <!-- SVG with the highest z-index -->
          <svg
            id="hourglass-svg"
            width="100%"
            height="100%"
            style="position: absolute; top: 0; left: 0; z-index: 30"
          ></svg>

          <!-- Info panels with lower z-index -->
          <div
            class="legend-container"
            id="hourglass-legend"
            style="z-index: 20"
          >
            <h3 class="legend-title">Rating Ranges</h3>
            <div class="legend-item">
              <div class="legend-color" style="background-color: #0072b2"></div>
              <div>1-1199 (50.9%)</div>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background-color: #56b4e9"></div>
              <div>1200-1699 (33.1%)</div>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background-color: #f0e442"></div>
              <div>1700-1899 (9.4%)</div>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background-color: #e69f00"></div>
              <div>1900-2299 (5.6%)</div>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background-color: #d55e00"></div>
              <div>2300+ (1.0%)</div>
            </div>
          </div>

          <div
            class="explanation-text"
            id="chess-explanation-hourglass"
            style="z-index: 20"
          >
            <h3 class="explanation-title">The Chess Pyramid</h3>
            <p>
              The journey from beginner to master in chess is one of the most
              challenging progressions in competitive games.
            </p>
            <p>
              Only 1% of players ever reach the 2300+ rating threshold where
              FIDE titles like International Master and Grandmaster begin.
            </p>
            <p>
              Each step up the rating ladder represents exponentially increasing
              difficulty, with small improvements requiring significant study
              and practice.
            </p>
          </div>
        </div>
      </div>

      <!-- Combined Player Rating Comparison and Map Section -->
      <div class="section chess-pattern-light chess-pieces-bg chess-border">
        <div class="container-fluid py-3">
          <!-- New row for portraits -->
          <div class="row mb-2">
            <div class="col-12 text-center">
              <h2 class="mb-4">
                Let's Introduce Two Elite Canadian Chess Players
              </h2>
              <!-- Player Portrait Frames - Now centered above both columns -->
              <div class="portraits-wrapper">
                <div class="player-portrait-container justify-content-center">
                  <div
                    id="aaron-portrait"
                    class="player-portrait aaron-portrait"
                    data-connection="india-canada"
                  >
                    <img src="img/aaron.jpg" alt="Aaron Reeve Mendes" />
                  </div>
                  <div
                    id="nikolay-portrait"
                    class="player-portrait nikolay-portrait"
                    data-connection="russia-canada"
                  >
                    <img src="img/noritsyn.jpg" alt="Nikolay Noritsyn" />
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Second row for map and rating progression -->
          <div class="row mt-5">
            <!-- Map Column (Left) -->
            <div class="col-lg-6 mb-3 mb-lg-0">
              <!-- Bio Container - Modified to be borderless -->
              <div
                id="player-bio-container"
                class="mb-3 player-bio-section"
                style="display: none; opacity: 0; transition: all 0.5s ease"
              >
                <h4 id="bio-name" class="bio-title"></h4>
                <p id="bio-text" class="bio-text"></p>
              </div>
              <div
                id="map-container"
                class="d-flex justify-content-center align-items-center flex-column"
                style="min-height: 320px; max-height: 350px"
              ></div>
            </div>
            <!-- Rating Progression Column (Right) -->
            <div class="col-lg-6">
              <div
                class="legend mb-2 d-flex justify-content-center align-items-center"
              >
                <div class="legend-item me-2">
                  <div
                    class="legend-color"
                    style="background-color: #2b83ba"
                  ></div>
                  <span>Aaron Reeve Mendes</span>
                </div>
                <button
                  id="resetZoom"
                  class="reset-button mt-1 mb-1 mx-2"
                  disabled
                >
                  Reset Zoom
                </button>
                <div class="legend-item ms-2">
                  <div
                    class="legend-color"
                    style="background-color: #d7191c"
                  ></div>
                  <span>Nikolay Noritsyn</span>
                </div>
              </div>

              <div
                class="chart-container"
                style="position: relative; height: 320px"
              >
                <div id="chart"></div>
              </div>
              <div id="rating-tooltip" class="rating-tooltip hidden"></div>

              <div class="context-chart" style="height: 40px">
                <div id="context"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Masters Section -->
      <div class="section chess-pattern-dark chess-pieces-bg chess-border">
        <div class="container">
          <div class="row text-center" id="masters-parent">
            <div class="col-12">
              <h2>Canadian National Masters</h2>
              <p>
                Visualization of when players achieved their National Master
                titles over time.
              </p>
              <p>
                The number of National Masters in Canada has grown steadily over
                the years.
              </p>
              <p>
                Is this still to be expected with the changing way the game is
                being played?
              </p>
              <div
                class="masters-container"
                style="height: 100vh; position: relative"
              >
                <div id="masters-visualization" class="mt-4"></div>
                <!-- Add tooltip container -->
                <div id="masters-tooltip" class="tooltip hidden">
                  <p><span id="masters-value"></span></p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Chess Game Visualization Section -->
      <div class="section chess-pattern-dark chess-pieces-bg chess-border">
        <div class="container">
          <div class="row text-center">
            <div class="col-12">
              <h2>Chess Visualizations</h2>
              <p>
                Analyzing the patterns and movements in Canadian chess games
              </p>
            </div>
          </div>
          <div class="row">
            <!-- Left side - Openings -->
            <div class="col-md-6">
              <h3>Chess Opening Variations</h3>
              <div class="cdv-openings" id="openings"></div>
              <div class="caption">
                Visualizing over 60,000 games played by top Canadian players.
                <br />
                Looking at variation: <span id="variation"></span> <br />
                Percentage of games with this variation:
                <span id="percentage"></span>
                <br />
                <button id="all" class="button button-primary">
                  All Openings
                </button>
                <button id="d4" class="button">d4 Variations</button>
              </div>
            </div>

            <!-- Right side - Move Paths -->
            <div class="col-md-6">
              <h3>Piece Movement Analysis</h3>
              <div id="heatmap-example-1" class="cdv-heatmap"></div>
              <div class="caption">
                Journey of the white queen's knight during games.
                <br />
                Visualizing move paths of 60,000 games played by top Canadian
                players.
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Top Arbiters and Organizers -->
      <div class="section chess-pattern-dark chess-pieces-bg chess-border">
        <div class="container">
          <div class="row text-center">
            <div class="col-12">
              <h2>Tournament Contributors</h2>
            </div>
          </div>
          <div class="row">
            <!-- Organizers Chart (Left Side) -->
            <div class="col-md-6">
              <h3>Tournament Organizers</h3>
              <div class="chart-container">
                <svg width="100%" height="500" id="organizers-chart"></svg>
                <div
                  class="tooltip"
                  style="
                    opacity: 0;
                    position: absolute;
                    background-color: white;
                    border: 1px solid #ddd;
                    padding: 10px;
                    border-radius: 5px;
                    pointer-events: none;
                  "
                ></div>
              </div>
              <div class="chart-legend mt-3">
                <p>
                  <strong>X-axis:</strong> Birth Year<br />
                  <strong>Y-axis:</strong> Number of Tournaments Organized<br />
                  <strong>Bubble Size:</strong> Total Players in Tournaments<br />
                  <strong>Colors:</strong> Canadian Provinces
                </p>
              </div>
            </div>

            <!-- Arbiters Chart (Right Side) -->
            <div class="col-md-6">
              <h3>Tournament Arbiters</h3>
              <div class="chart-container">
                <svg width="100%" height="500" id="arbiters-chart"></svg>
                <div
                  class="tooltip"
                  style="
                    opacity: 0;
                    position: absolute;
                    background-color: white;
                    border: 1px solid #ddd;
                    padding: 10px;
                    border-radius: 5px;
                    pointer-events: none;
                  "
                ></div>
              </div>
              <div class="chart-legend mt-3">
                <p>
                  <strong>X-axis:</strong> Birth Year<br />
                  <strong>Y-axis:</strong> Number of Tournaments Arbitered<br />
                  <strong>Bubble Size:</strong> Total Players in Tournaments<br />
                  <strong>Colors:</strong> Canadian Provinces
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- About Us Section -->
      <div
        class="section chess-pattern-dark chess-pieces-bg chess-border d-flex align-items-center"
      >
        <div class="container">
          <div class="row text-center">
            <div class="col-12">
              <h1>
                Canadian Chess has a lot to look up towards as we see exciting
                progress in player development, arbiters, and organizers!
              </h1>
            </div>
          </div>
        </div>
      </div>

      <!-- About Us Section -->
      <div
        class="section chess-pattern-dark chess-pieces-bg chess-border d-flex align-items-center"
      >
        <div class="container">
          <div class="row text-center">
            <div class="col-12">
              <h1>About Us</h1>
              <p>
                Created by Victor Zheng, Andy Feng, and Harsh Bajwa at the
                University of Toronto's CSC316 Data Visualization course.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- TopoJSON -->
    <script src="https://d3js.org/topojson.v2.min.js"></script>

    <!-- Load d3-cloud -->
    <script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3.layout.cloud.js"></script>

    <!-- Custom JS -->
    <script src="js/Balls.js"></script>
    <script src="js/title_page.js"></script>
    <script src="js/masters-timeline.js"></script>
    <script src="js/ratings-progress.js"></script>
    <script src="js/world_map.js"></script>
    <script src="js/chess-openings.js"></script>
    <script src="js/chess-heat-maps.js"></script>
    <script src="js/organizers.js"></script>
    <script src="js/arbiters.js"></script>

    <!-- Initialize Fullpage stepper -->
    <script>

      // Initialize fullpage.js
      new fullpage("#fullpage", {
          // Options here
          anchors: ["ChessViz", "Masters", "Ratings", "Demographics", "Map"],

          // AutoScrolling false because story boxes need vertical scrolling
          autoScrolling: false,
          scrollingSpeed: 500,
          scrollHorizontally: false,

          onLeave: function (origin, destination) {
            destination.item.classList.add("load-background");

            // Add chess animation class on section change
            destination.item.classList.add("chess-animate");
            setTimeout(() => {
              destination.item.classList.remove("chess-animate");
            }, 800);
          },
          slidesNavigation: true,
          navigation: true,
          navigationPosition: "right",
        });

      // Setup for initial sections
      document.addEventListener("DOMContentLoaded", function () {
        // Custom navigation for first three sections
        document
          .querySelector("#title-section .nav-indicator")
          .addEventListener("click", function () {
            window.scrollTo({
              top: document.getElementById("grid-section").offsetTop,
              behavior: "smooth",
            });
          });

        document
          .querySelector("#grid-section .nav-indicator")
          .addEventListener("click", function () {
            window.scrollTo({
              top: document.getElementById("hourglass-section").offsetTop,
              behavior: "smooth",
            });
          });

        document
          .querySelector("#hourglass-section")
          .addEventListener("wheel", function (e) {
            if (e.deltaY > 0) {
              // Scrolling down
              // Scroll to the start of fullpage content
              window.scrollTo({
                top: document.getElementById("fullpage").offsetTop,
                behavior: "smooth",
              });
            }
          });
      });

    </script>
  </body>
</html>
